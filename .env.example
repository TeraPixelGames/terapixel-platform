# Shared
# Preferred (RS256)
SESSION_SIGNING_ALG=RS256
SESSION_SIGNING_KEY_ID=tpx-session-v1
SESSION_SIGNING_KEY_PEM=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n
# Optional explicit public key (derived automatically from private key when omitted on identity-gateway)
# SESSION_PUBLIC_KEY_PEM=-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----\n
# Compatibility fallback (HS256 only; keep empty in RS256 deployments)
# SESSION_SECRET=replace-with-32-char-secret
SESSION_JWKS_URL=http://localhost:8080/.well-known/jwks.json
SESSION_JWKS_TTL_SECONDS=600
SESSION_ISSUER=terapixel.identity
SESSION_AUDIENCE=terapixel.game
CLOCK_SKEW_SECONDS=10
SESSION_LEGACY_CUTOFF_UTC=2026-05-31T00:00:00Z
# Optional environment-specific cutoffs
# SESSION_LEGACY_CUTOFF_PROD_UTC=2026-05-31T00:00:00Z
# SESSION_LEGACY_CUTOFF_STAGING_UTC=2026-04-30T00:00:00Z
# Optional explicit overrides (otherwise derived from cutoff date)
# SESSION_ALLOW_LEGACY_HS256=true
# SESSION_ALLOW_LEGACY_NAKAMA_SUBJECT=true
# SESSION_REQUIRE_SUB=false
CORS_ALLOWED_ORIGINS=*
IDENTITY_ADMIN_KEY=replace-with-identity-admin-key
INTERNAL_SERVICE_KEY=replace-with-internal-service-key
IAP_CHECKOUT_BASE_URL=https://checkout.terapixel.games/mock

# Identity Gateway
HOST=0.0.0.0
PORT=8080
BODY_LIMIT_BYTES=65536
CRAZYGAMES_EXPECTED_AUDIENCE=lumarush
CRAZYGAMES_EXPECTED_ISSUER=https://sdk.crazygames.com/authentication/
CRAZYGAMES_JWKS_URL=https://sdk.crazygames.com/authentication/keys.json
JWKS_TTL_SECONDS=600
SESSION_TTL_SECONDS=3600
IDENTITY_STORE_TYPE=memory
# DATABASE_URL=postgres://user:pass@host:5432/db
# IAP_INTERNAL_MERGE_URL=http://localhost:8110/v1/iap/internal/merge-profile
# SAVE_INTERNAL_MERGE_URL=http://localhost:8090/v1/save/internal/merge-profile
# FLAGS_INTERNAL_MERGE_URL=http://localhost:8070/v1/flags/internal/merge-profile
# TELEMETRY_INTERNAL_MERGE_URL=http://localhost:8100/v1/telemetry/internal/merge-profile
MAGIC_LINK_FROM_EMAIL=no-reply@terapixel.games
MAGIC_LINK_REPLY_TO_EMAIL=support@terapixel.games
MAGIC_LINK_SUBJECT=Terapixel Games Magic Link
MAGIC_LINK_BASE_URL=https://terapixel.games/api/v1/account/magic-link/consume
# MAGIC_LINK_MOBILE_BASE_URL=terapixel://auth/magic-link
MAGIC_LINK_SIGNING_SECRET=replace-with-32-char-secret
MAGIC_LINK_TTL_SECONDS=900
MAGIC_LINK_RATE_LIMIT_PER_HOUR=5
USERNAME_BLOCKLIST_GLOBAL=admin,moderator,support
USERNAME_BLOCKLIST_BY_GAME_JSON={"lumarush":["badword1","badword2"],"color_crunch":["badword1","badword2"]}
MAGIC_LINK_DEFAULT_GAME_ID=color_crunch
MAGIC_LINK_NAKAMA_NOTIFY_TARGETS_JSON={"lumarush":{"notify_url":"https://lumarush-nakama.onrender.com/v2/rpc/tpx_account_magic_link_notify","notify_http_key":"replace-with-nakama-runtime-http-key","shared_secret":"replace-with-shared-secret"},"color_crunch":{"notify_url":"https://colorcrunch-nakama.onrender.com/v2/rpc/tpx_account_magic_link_notify","notify_http_key":"replace-with-nakama-runtime-http-key","shared_secret":"replace-with-shared-secret"}}
# Legacy single-target fallback (optional)
MAGIC_LINK_NAKAMA_NOTIFY_URL=https://lumarush-nakama.onrender.com/v2/rpc/tpx_account_magic_link_notify
MAGIC_LINK_NAKAMA_NOTIFY_HTTP_KEY=replace-with-nakama-runtime-http-key
MAGIC_LINK_NAKAMA_NOTIFY_SECRET=replace-with-shared-secret
# Optional dynamic runtime config source of truth
# PLATFORM_CONFIG_STORE_TYPE=postgres
# PLATFORM_CONFIG_SERVICE_URL=https://terapixel-control-plane.onrender.com
# PLATFORM_CONFIG_INTERNAL_KEY=replace-with-internal-service-key
# PLATFORM_CONFIG_ENVIRONMENT=prod
# PLATFORM_CONFIG_CACHE_TTL_SECONDS=15
# PLATFORM_CONFIG_ENCRYPTION_KEY=base64-32-byte-key
SMTP_HOST=smtp-relay.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_SECURE=false
SMTP_REQUIRE_TLS=true

# Control Plane Service
# PORT=8090
# GOOGLE_OAUTH_CLIENT_ID=google-oauth-client-id.apps.googleusercontent.com
# GOOGLE_WORKSPACE_DOMAINS=terapixel.games
# CONTROL_PLANE_BOOTSTRAP_EMAILS=admin@terapixel.games
# CONTROL_PLANE_ONBOARDING_KEY=long-random-machine-onboarding-key
# PLATFORM_CONFIG_ENCRYPTION_KEY=base64-32-byte-key

# Save Service
# HOST=0.0.0.0
# PORT=8090
# BODY_LIMIT_BYTES=262144
# SAVE_STORE_TYPE=file
# SAVE_STORE_FILE_PATH=./data/save-service.json
# SAVE_STORE_TYPE=postgres
# DATABASE_URL=postgres://user:pass@host:5432/db
# SAVE_STORE_TABLE=save_envelopes
# PLATFORM_CONFIG_STORE_TYPE=postgres
# PLATFORM_CONFIG_SERVICE_URL=https://terapixel-control-plane.onrender.com
# PLATFORM_CONFIG_INTERNAL_KEY=replace-with-internal-service-key
# PLATFORM_CONFIG_ENVIRONMENT=prod
# PLATFORM_CONFIG_CACHE_TTL_SECONDS=15

# Feature Flags Service
# HOST=0.0.0.0
# PORT=8070
# BODY_LIMIT_BYTES=65536
# FLAG_STORE_TYPE=file
# FLAG_STORE_FILE_PATH=./data/feature-flags.json
# FEATURE_FLAGS_BOOTSTRAP_JSON={"games":{"lumarush":{"defaults":{"new_ui":false}}}}
# FEATURE_FLAGS_ADMIN_KEY=replace-with-admin-key
# DATABASE_URL=postgres://user:pass@host:5432/db
# PLATFORM_CONFIG_STORE_TYPE=postgres
# PLATFORM_CONFIG_SERVICE_URL=https://terapixel-control-plane.onrender.com
# PLATFORM_CONFIG_INTERNAL_KEY=replace-with-internal-service-key
# PLATFORM_CONFIG_ENVIRONMENT=prod
# PLATFORM_CONFIG_CACHE_TTL_SECONDS=15

# Telemetry Ingest Service
# HOST=0.0.0.0
# PORT=8100
# BODY_LIMIT_BYTES=262144
# TELEMETRY_REQUIRE_SESSION=true
# TELEMETRY_MAX_EVENTS_PER_REQUEST=100
# TELEMETRY_STORE_TYPE=file
# TELEMETRY_FILE_PATH=./data/telemetry-events.jsonl
# DATABASE_URL=postgres://user:pass@host:5432/db
# PLATFORM_CONFIG_STORE_TYPE=postgres
# PLATFORM_CONFIG_SERVICE_URL=https://terapixel-control-plane.onrender.com
# PLATFORM_CONFIG_INTERNAL_KEY=replace-with-internal-service-key
# PLATFORM_CONFIG_ENVIRONMENT=prod
# PLATFORM_CONFIG_CACHE_TTL_SECONDS=15

# IAP Service
# IAP_STORE_TYPE=file
# IAP_STORE_FILE_PATH=./data/iap-store.json
# IAP_STORE_TYPE=postgres
# DATABASE_URL=postgres://user:pass@host:5432/db
# PLATFORM_CONFIG_STORE_TYPE=postgres
# PLATFORM_CONFIG_SERVICE_URL=https://terapixel-control-plane.onrender.com
# PLATFORM_CONFIG_INTERNAL_KEY=replace-with-internal-service-key
# PLATFORM_CONFIG_ENVIRONMENT=prod
# PLATFORM_CONFIG_CACHE_TTL_SECONDS=15
# PLATFORM_CONFIG_ENCRYPTION_KEY=base64-32-byte-key
# IAP_ADMIN_KEY=replace-with-iap-admin-key
# IAP_APPLE_SHARED_SECRET=apple-shared-secret
# IAP_GOOGLE_CLIENT_EMAIL=service-account@project.iam.gserviceaccount.com
# IAP_GOOGLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n
# IAP_PAYPAL_CLIENT_ID=paypal-client-id
# IAP_PAYPAL_CLIENT_SECRET=paypal-client-secret
